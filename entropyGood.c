#include <math.h>
#include <string.h>
#include <stddef.h>

double calculate_entropy(const char *buffer, size_t size){
	if (size == 0) { // ë°ì´í„°ì˜ í¬ê¸°ê°€ 0ì´ë©´ ê³„ì‚° ì•ˆí•˜ê¸°
		return 0.0;
	}

	long long counts[256]; //0~255 ê¹Œì§€ 256 ê°œì˜ ê°’ì´ ê°ê° ëª‡ ë²ˆ ë“±ì¥í–ˆëŠ”ì§€ ì €ì¥í•˜ëŠ” ë°°ì—´
	memset(counts, 0, sizeof(counts)); //mamset() ëŠ” ë°°ì—´ 256 ê°œì˜ ì¹¸ì„ 0ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ëŠ” ê²ƒ

	for (size_t i =0; i<size; i++){ // 0ë²ˆì§¸ë¶€í„° (size-1) ë°”ì´íŠ¸ê¹Œì§€ í•˜ë‚˜ì”© ìˆœíšŒ
		counts[(unsigned char) buffer[i]]++; //unsignedë¡œ ìŒìˆ˜ê°’ì€ ì €ì¥ì•ˆë˜ê²Œ
	} //ì˜ˆ) i =65('A') ì´ë©´ counts[65] ì˜ ê°’ì„ +1í•˜ëŠ” ê²ƒì„

	double entropy = 0.0; //ì—”íŠ¸ë¡œí”¼ ê°’ì„ ëˆ„ì í•˜ëŠ” ë³€ìˆ˜ ì„ ì–¸

	for (int i = 0; i < 256; i++){ 
		if (counts[i] == 0){//ë°”ì´íŠ¸ê°’ì´ ë°ì´í„°ì— í•œ ë²ˆë„ ë“±ì¥í•˜ì§€ ì•Šìœ¼ë©´ í™•ë¥ p =0 == ì—°ì‚° ì•ˆ í•¨
			continue;
		}

		double probability = (double)counts[i] / size; /*  ì™œ sizeë¡œ ë‚˜ëˆ„ëŠ”ê°€?

counts[i]ëŠ” ë²„í¼ ì•ˆì—ì„œ íŠ¹ì • ë°”ì´íŠ¸ ê°’ì´ ë“±ì¥í•œ íšŸìˆ˜
ì˜ˆ:

ì „ì²´ ë°ì´í„° í¬ê¸° = 1000ë°”ì´íŠ¸

0x41('A') ë°”ì´íŠ¸ê°€ 50ë²ˆ ë“±ì¥

ê·¸ëŸ¬ë©´ 'A'ê°€ ë“±ì¥í•  í™•ë¥ ì€:
ğ‘(â€²ğ´â€²)=50/1000=0.05

ì¦‰ ì „ì²´ ë°ì´í„° ì¤‘ì—ì„œ í•´ë‹¹ ë°”ì´íŠ¸ê°€ ì°¨ì§€í•˜ëŠ” ë¹„ìœ¨ì„ êµ¬í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì´ ë°ì´í„° í¬ê¸°ì¸ sizeë¡œ ë‚˜ëˆ ì£¼ëŠ” ê²ƒ
*/

		entropy -= probability * log2(probability); //ì—”íŠ¸ë¡œí”¼ ê³µì‹ì— ì˜í•´ ê° ë°”ì´íŠ¸ë¥¼ ëˆ„ì í•œ ìµœì¢… ì—”íŠ¸ë¡œí”¼ ê³„ì‚°
	}
	return entropy;
}
/*ë§Œì•½ ë°ì´í„°ê°€ 'A'ë¡œë§Œ ê°€ë“ ì°¨ ìˆë‹¤ë©´ (ì˜ˆ: "AAAAA"):
     * P('A') = 1.0, P(ë‚˜ë¨¸ì§€) = 0.
     * entropy = - (1.0 * log2(1.0)) = - (1.0 * 0) = 0.0 */
/* ë™ì¼í•œ ë¬¸ìê°€ ë°˜ë³µë˜ë©´ ì—”íŠ¸ë¡œí”¼ ë‚®ì•„ì§€ëŠ” ì €ì—”íŠ¸ë¡œí”¼ ìš°íšŒë°©ë²•ì„ red íŒ€ì´ ì‚¬ìš©ê°€ëŠ¥í•¨ -> ë§‰ëŠ” ë°©ë²•ë„ ì¶”ê°€ë¡œ ê³ ë ¤í•´ë´ì•¼í•¨*/
